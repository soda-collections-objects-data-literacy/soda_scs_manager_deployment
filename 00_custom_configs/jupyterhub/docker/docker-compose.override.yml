# Docker Compose Override for SCS JupyterHub Stack Integration
# This file overrides the base docker-compose.yml to integrate with the main SCS deployment
# It adds Traefik integration, proper networking, and consistent naming

services:
  # JupyterHub Service
  jupyterhub--jupyterhub:
    container_name: ${JUPYTERHUB_SERVICE_NAME}
    env_file: !reset
    build:
      context: jupyterhub/jupyterhub
    environment:
      # Override with parent environment variables
      CLIENT_SECRET: ${JUPYTERHUB_CLIENT_SECRET}
      CLIENT_ID: ${JUPYTERHUB_CLIENT_ID}
    networks: !reset
      - reverse-proxy
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=reverse-proxy"
      - "traefik.http.routers.jupyterhub--jupyterhub.rule=Host(`${JUPYTERHUB_DOMAIN}`)"
      - "traefik.http.routers.jupyterhub--jupyterhub.entrypoints=websecure"
      - "traefik.http.routers.jupyterhub--jupyterhub.tls=true"
      - "traefik.http.routers.jupyterhub--jupyterhub.tls.certresolver=le"
      - "traefik.http.services.jupyterhub--jupyterhub.loadbalancer.server.port=8000"

  # Spawner Image Builder
  jupyterhub--image-builder:
    container_name: jupyterhub--image-builder
    build:
      context: jupyterhub/spawner_image

